generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  Admin_ID  Int         @id @default(autoincrement())
  Name      String?
  Email     String?     @unique
  Password  String?
  Role      String?
  TimeTable TimeTable[]

  @@map("Admin")
}

model Zone {
  Zone_id        Int              @id @default(autoincrement())
  Zone_Name      String?
  Camara         Camara[]
  TimeTable      TimeTable[]
  ActivePresence ActivePresence[]
  AttendanceLog  AttendanceLog[]

  @@map("Zone")
}

model Camara {
  Camara_Id   Int     @id @default(autoincrement())
  Password    String?
  Zone_id     Int?
  Camera_Type String? @default("Entry") // "Entry" or "Exit"
  Camera_URL  String? // RTSP URL or device index
  zone        Zone?   @relation(fields: [Zone_id], references: [Zone_id])

  @@map("Camara")
}

model Teacher {
  Teacher_ID      Int              @id @default(autoincrement())
  Name            String?
  Email           String?          @unique
  CreatedAt       DateTime         @default(now())
  Department      String?
  Face_Picture_1  String?
  Face_Picture_2  String?
  Face_Picture_3  String?
  Face_Picture_4  String?
  Face_Picture_5  String?
  Face_Embeddings Bytes? // Serialized face encodings
  Faculty_Type    String?
  Gender          String?
  UpdatedAt       DateTime         @updatedAt
  TimeTable       TimeTable[]
  ActivePresence  ActivePresence[]
  AttendanceLog   AttendanceLog[]
  ProcessedImages ProcessedFaceImages[]

  @@map("Teacher")
}

model Students {
  Student_ID      Int              @id @default(autoincrement())
  Name            String?
  RollNumber      String?          @unique
  Email           String?          @unique
  Face_Picture_1  String?
  Face_Picture_2  String?
  Face_Picture_3  String?
  Face_Picture_4  String?
  Face_Picture_5  String?
  Face_Embeddings Bytes? // Serialized face encodings
  CreatedAt       DateTime         @default(now())
  UpdatedAt       DateTime         @updatedAt
  Department      String?
  Gender          String?
  TimeTable       TimeTable[]
  ActivePresence  ActivePresence[]
  AttendanceLog   AttendanceLog[]
  ProcessedImages ProcessedFaceImages[]

  @@map("Students")
}

model TimeTable {
  TimeTable_ID Int       @id @default(autoincrement())
  EntryTime    DateTime?
  ExitTime     DateTime?
  PersonType   String?
  Admin_ID     Int?
  Teacher_ID   Int?
  Student_ID   Int?
  Zone_id      Int?
  admin        Admin?    @relation(fields: [Admin_ID], references: [Admin_ID])
  student      Students? @relation(fields: [Student_ID], references: [Student_ID])
  teacher      Teacher?  @relation(fields: [Teacher_ID], references: [Teacher_ID])
  zone         Zone?     @relation(fields: [Zone_id], references: [Zone_id])

  @@map("TimeTable")
}

model UnknownFaces {
  Unknown_ID     Int      @id @default(autoincrement())
  Captured_Image Bytes?
  DetectedTime   DateTime @default(now())
  Zone_id        Int?
  Confidence     Float?
  Status         String?  @default("PENDING")
  Notes          String?
  CreatedAt      DateTime @default(now())

  @@map("UnknownFaces")
}

model ActivePresence {
  Presence_ID Int       @id @default(autoincrement())
  PersonType  String // "Student" or "Teacher"
  Student_ID  Int?
  Teacher_ID  Int?
  Zone_id     Int
  EntryTime   DateTime  @default(now())
  student     Students? @relation(fields: [Student_ID], references: [Student_ID], onDelete: Cascade)
  teacher     Teacher?  @relation(fields: [Teacher_ID], references: [Teacher_ID], onDelete: Cascade)
  zone        Zone      @relation(fields: [Zone_id], references: [Zone_id], onDelete: Cascade)

  @@map("ActivePresence")
}

model AttendanceLog {
  Log_ID     Int       @id @default(autoincrement())
  PersonType String // "Student" or "Teacher"
  Student_ID Int?
  Teacher_ID Int?
  Zone_id    Int
  EntryTime  DateTime
  ExitTime   DateTime?
  Duration   Int? // Minutes spent in zone
  CreatedAt  DateTime  @default(now())
  student    Students? @relation(fields: [Student_ID], references: [Student_ID], onDelete: Cascade)
  teacher    Teacher?  @relation(fields: [Teacher_ID], references: [Teacher_ID], onDelete: Cascade)
  zone       Zone      @relation(fields: [Zone_id], references: [Zone_id], onDelete: Cascade)

  @@map("AttendanceLog")
}

model ProcessedFaceImages {
  Processed_ID Int      @id @default(autoincrement())
  PersonType   String // "Student" or "Teacher"
  Student_ID   Int?
  Teacher_ID   Int?
  Image1       Bytes?
  Image2       Bytes?
  Image3       Bytes?
  Image4       Bytes?
  Image5       Bytes?
  CreatedAt    DateTime @default(now())
  student      Students? @relation(fields: [Student_ID], references: [Student_ID], onDelete: Cascade)
  teacher      Teacher?  @relation(fields: [Teacher_ID], references: [Teacher_ID], onDelete: Cascade)

  @@map("ProcessedFaceImages")
}
